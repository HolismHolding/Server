. /HolismHolding/Server/Message.sh

CurrentDir=$PWD

echo
if [ ! -f /$CurrentDir/Ports ]; then
    Error "Ports file is not found in the /$CurrentDir directory"
    exit;  
fi
set -a
source /$CurrentDir/Ports
set +a

function GenerateSiteAndPanelDockerCompose()
{
    envsubst < /HolismHolding/Server/DockerCompose/SiteAndPanel > /$Organization/$Repository/docker-compose-temp.yml
}

function SetPort()
{
    envsubst < /$Organization/$Repository/docker-compose-temp.yml > /$Organization/$Repository/docker-compose.yml
    rm /$Organization/$Repository/docker-compose-temp.yml
}

for i in $(find . -mindepth 1 -maxdepth 1 -type d -printf '%f\n'); do
    cd $CurrentDir/$i
    . /HolismHolding/Server/Extract
    if [[ $i == *"Api" ]]; then
        Success "$i is API"
    elif [[ $i == *"Panel" ]]; then
        GenerateSiteAndPanelDockerCompose
    elif [[ $i == "Accounts" ]]; then
        Success "$i is Accounts"
    elif [[ $i == "Blog" ]]; then
        Success "$i is Blog"
    elif [[ $i == "Site" ]]; then
        GenerateSiteAndPanelDockerCompose
    elif [[ $i == "Databases" ]]; then
        Success "$i is Databases"
    else
        Error "$i is unknown"
        exit;
    fi
    SetPort
    Divide
done