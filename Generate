. /HolismHolding/Server/Message.sh

CurrentDir=$PWD

echo
if [ ! -f /$CurrentDir/Params ]; then
    Error "Params file is not found in the /$CurrentDir directory"
    exit;  
fi
set -a
source /$CurrentDir/Params
set +a

function GenerateAccountsDockerCompose()
{
    envsubst < /HolismHolding/Server/DockerCompose/Accounts > /$Organization/$Repository/docker-compose-temp.yml
}

function GenerateSiteAndBlogAndPanelDockerCompose()
{
    envsubst < /HolismHolding/Server/DockerCompose/SiteAndBlogAndPanel > /$Organization/$Repository/docker-compose-temp.yml
}

function GenerateDatabasesDockerCompose()
{
    envsubst < /HolismHolding/Server/DockerCompose/Databases > /$Organization/$Repository/docker-compose-temp.yml
}

function GenerateApiDockerCompose()
{
    envsubst < /HolismHolding/Server/DockerCompose/Api > /$Organization/$Repository/docker-compose-temp.yml
}

function SetPort()
{
    envsubst < /$Organization/$Repository/docker-compose-temp.yml > /$Organization/$Repository/docker-compose.yml
    rm /$Organization/$Repository/docker-compose-temp.yml
}

for i in $(find . -mindepth 1 -maxdepth 1 -type d -printf '%f\n'); do
    cd $CurrentDir/$i
    . /HolismHolding/Server/Extract
    if [[ $i == *"Api" ]]; then
        GenerateApiDockerCompose
    elif [[ $i == *"Panel" ]]; then
        GenerateSiteAndBlogAndPanelDockerCompose
    elif [[ $i == "Accounts" ]]; then
        GenerateAccountsDockerCompose
    elif [[ $i == "Blog" ]]; then
        GenerateSiteAndBlogAndPanelDockerCompose
    elif [[ $i == "Site" ]]; then
        GenerateSiteAndBlogAndPanelDockerCompose
    elif [[ $i == "Databases" ]]; then
        GenerateDatabasesDockerCompose
    else
        Error "$i is unknown"
        exit;
    fi
    SetPort
    # Divide
done